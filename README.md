# Brick Breaker - Design Document

This document outlines the design and mechanics of the p5.js Brick Breaker game, serving as a guideline for development.

## Core Gameplay Loop

The game is a modern take on the classic brick breaker genre, incorporating rogue-like progression, resource management, and deep customization. The player aims a ball, launches it, and destroys bricks on the screen. The primary goal is to destroy all designated "Goal Bricks" to advance to the next level.

*   **Aiming & Firing**: The player clicks and drags to aim a trajectory line, then releases to fire the ball.
*   **Ball Health**: The player's ball has Health Points (HP). It loses HP by hitting walls. If the ball's HP reaches zero, it is destroyed. The run ends if all balls are lost.
*   **Power-ups**: Most ball types have a limited number of special abilities (power-ups) that can be activated by clicking while the ball is in motion.
*   **Combos**: Hitting bricks sequentially without hitting a wall builds a combo, which can trigger powerful end-of-turn rewards.

---

## Game Modes

The game features three distinct modes: Adventure Run, Trial Run, and Home Base.

### Adventure Run

This is the main rogue-like mode where players progress through increasingly difficult levels, collecting resources and temporary upgrades.

*   **Progression**: Each run starts at Level 1 (or a higher milestone level) and continues until the player runs out of balls. Player XP, Gems, and main level are persistent between runs.
*   **Resources**:
    *   **Coins (ðŸª™)**: Collected from bricks during a run and spent in the Shop on temporary upgrades. Resets after each run.
    *   **Gems (ðŸ’Ž)**: A premium currency occasionally found in bricks. Used for permanent upgrades in the Skill Tree.
*   **Systems**: This mode features the Shop, Equipment drops, the Combo system, and branching paths between levels, offering choices that affect the next stage.

### Trial Run

A pure skill-based mode that challenges players to see how far they can get with a limited, pre-selected set of balls.

*   **Ball System**: The run starts by consuming all consumable balls stored in the player's Home Base. This becomes the player's entire ball inventory for the run.
*   **No Shop or Equipment**: There are no coins, shop upgrades, or equipment drops in this mode.
*   **End Condition**: The run ends when the player's last ball is used. Any unused balls are refunded to the Home Base.
*   **Separate Records**: Trial Runs have their own "Highest Level Reached" record, tracked independently of Adventure Runs.
*   **Customization**: The level generation parameters for Trial Runs can be customized via the Level Settings menu.

### Home Base

A persistent base-building and resource management mode that unlocks after the player's first Adventure Run. There is no active brick-breaking gameplay here.

*   **Gameplay**: Players place and upgrade buildings on a grid to generate resources passively over time. These resources can be spent to craft new buildings or produce consumable balls for Trial Runs.
*   **Resources**:
    *   **Food (ðŸ¥•)**: Generated by `Farmland` buildings. Used to purchase certain buildings and produce balls.
    *   **Wood (ðŸªµ)**: Generated by `Sawmill` buildings. Used to purchase buildings.
*   **Buildings**: Key buildings include `Farmland`, `Sawmill`, resource `Storage`, `Ball Producers`, and `Empty Cages` (to store produced balls).

---

## Progression & Feature Unlocks

The game features a persistent progression system based on the player's main XP Level. **XP, Main Level, Gems, and Home Base progress are never reset.**

New features unlock as the player gains levels:

*   **After 1st Run**: **Home Base** mode is unlocked.
*   **Level 2**: `ExplosiveBall` unlocked.
*   **Level 3**: **Coins** and the **Shop** unlocked.
*   **Level 4**: **Combo System** (with Mine rewards) unlocked.
*   **Level 5**: **Gems (ðŸ’Ž)** and the **Skill Tree** unlocked.
*   **Level 6**: `SplitBall` unlocked.
*   **Level 7**: `ExplosiveBrick` spawns unlocked.
*   **Level 8**: Ability to **purchase Extra Balls** in the shop.
*   **Level 9**: `PiercingBall` unlocked.
*   **Level 10**: **Equipment System** unlocked.
*   **Level 11**: **Stripe Brick** combo rewards unlocked.
*   **Level 12**: `BrickBall` unlocked.
*   **Level 15**: `BulletBall` unlocked.
*   **Level 18**: `HomingBall` unlocked.
*   **Level 20**: **Special Bricks** (`WoolBrick`, `ShieldGenBrick`) unlocked.

---

## Core Systems

### Shop

Unlocked at Level 3 in Adventure Mode, the shop allows players to spend **Coins (ðŸª™)** on temporary upgrades that last for the current run. Available upgrades include purchasing extra balls, buying random equipment, and improving the stats of various ball types.

### Equipment System

Unlocked at Level 10, this system allows players to customize their balls with passive abilities by equipping items.

*   **Acquisition**: Equipment is found in special `Equipment` bricks or purchased from the shop.
*   **Inventory & Slots**: Equipment is stored in a persistent inventory. Each ball type has three slots that can be unlocked.
*   **Rarity**: Equipment comes in **Common**, **Rare**, and **Epic** rarities, affecting its power.
*   **Effects**: Equipment can provide a wide range of effects, such as bonus damage, healing, unique projectiles on wall hits, XP boosts, and much more. (See `equipment.js` for a full list).

### Skill Tree

Unlocked at Level 5, the Skill Tree allows players to spend persistent **Gems (ðŸ’Ž)** on permanent upgrades that affect all future Adventure Runs. Upgrades are arranged in tiers, requiring the purchase of an upgrade in the previous tier to unlock the next. Skills include starting with more coins, adding special bricks to levels, and enhancing the "Golden Turn" event.

---

## Game Elements

### Ball Types

*   `classic`: Durable starting ball with 150% base HP.
*   `explosive`: Power-up creates an area-of-effect explosion.
*   `piercing`: Power-up lets it phase through a set number of bricks.
*   `split`: Power-up splits it into multiple smaller, weaker balls.
*   `brick`: Power-up spawns a ring of new bricks.
*   `bullet`: Power-up fires a cross-pattern of piercing projectiles.
*   `homing`: Power-up launches a projectile that seeks Goal bricks.
*   `giant`: A large, consumable ball that pierces all bricks but is destroyed on wall contact.

### Brick Types (In Runs)

*   `normal`: Standard brick with health indicated by color and layers.
*   `goal`: Yellow brick that must be destroyed to clear the level.
*   `extraBall`: Green brick that grants an extra ball.
*   `explosive`: Orange brick that explodes when destroyed.
*   `stripe`: Red brick that clears its row or column.
*   `ballCage`: Releases a clone of the player's ball when destroyed.
*   `wool`: A pink brick immune to all indirect damage (explosions, projectiles, etc.).
*   `shieldGen`: A blue, rounded brick that projects a damage-reduction aura to nearby bricks.

### Home Base Bricks (Buildings)

*   `Farmland`: Produces Food (ðŸ¥•) over time.
*   `Sawmill`: Grows `LogBrick`s on adjacent empty tiles.
*   `FoodStorage` / `WoodStorage`: Increase maximum resource capacity.
*   `LogBrick`: A resource brick worth 10 Wood (ðŸªµ).
*   `BallProducer`: Crafts consumable balls for Trial Runs.
*   `EmptyCage`: Stores crafted balls.

### Brick Overlays (Applied to `normal` bricks)

*   `builder`: Spawns or buffs adjacent bricks at the end of a turn.
*   `healer`: Heals nearby bricks at the end of a turn.
*   `mine`: Explodes when hit by the ball.
*   `zapper`: Deals periodic damage to the ball if it's within its aura.
*   `zap_battery`: Increases the range of a `Zapper`'s aura.
